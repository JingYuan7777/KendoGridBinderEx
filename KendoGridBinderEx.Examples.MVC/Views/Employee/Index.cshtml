@{
    ViewBag.Title = "Employee Grid Example";
}

<h3>All Employees</h3>
<div id="grid"></div>
<br/>
<div id="gridWithGroup"></div>
<br/>
<br/>
@using (Html.BeginForm("Create", "Employee", FormMethod.Get)) {
    <button class="buttonAdd" id="buttonAdd">Create new</button>
}
<br/>
<br/>
<h3>Only Managers</h3>
<div data-bind='kendoGrid: managers'></div>
<br/>


<script type="text/javascript">
    $(function () {
        $("#buttonAdd").button({
            icons: {
                primary: "ui-icon-add"
            },
            text: true
        });
    });

    $(document).ready(function () {
        var dataSource = {
            serverPaging: true,
            serverSorting: true,
            serverFiltering: true,
            pageSize: 5,
            transport: {
                read: {
                    type: 'post',
                    dataType: 'json',
                    url: url = '@Url.Action("Grid")'
                }
            },
            schema: {
                data: 'Data',
                total: 'Total',
                model: {
                    id: 'Id',
                    fields: {
                        CompanyName: { type: 'string' },
                        MainCompanyName: { type: 'string' },
                        Number: { type: 'number' },
                        First: { type: 'string' },
                        Last: { type: 'string' },
                        Full: { type: 'string' },
                        Email: { type: 'string' },
                        HireDate: { type: 'date' },
                        IsManager: { type: 'boolean' }
                    }
                }
            }
        };

        $('#grid').kendoGrid({
            dataSource: dataSource,
            height: '220px',
            columns: [
                {
                    field: 'Id', width: '78px', filterable: false, sortable: false, title: ' ',
                    template:
                        '<a href="/Employee/Details/#=Id#"><img class=iconLink src=/Content/Images/view.png></a>' + '&nbsp;' +
                            '<a href="/Employee/Edit/#=Id#"><img class=iconLink src=/Content/Images/edit.png></a>' +
                            '<a href="/Employee/Delete/#=Id#"><img class=iconLink style=padding-right:0px src=/Content/Images/delete.png></a>'
                },
                { field: 'CompanyName', title: 'Company' },
                { field: 'MainCompanyName', title: 'Main Company' },
                { field: 'Number', title: 'Employee #' },
                { field: 'First', title: 'FirstName' },
                { field: 'Last', title: 'LastName' },
                { field: 'Full', title: 'FullName' },
                { field: 'Email' },
                { field: 'HireDate', title: 'Hire Date', format: "{0:yyyy-MM-dd}" },
                { field: 'IsManager', title: 'Manager' }
            ],
            filterable: true,
            sortable: {
                mode: 'multiple'
            },
            pageable: {
                refresh: true,
                pageSizes: true
            }
        });
        
        var dataSourceWithGroup = {
            serverPaging: true,
            serverSorting: true,
            serverFiltering: true,
            serverGrouping: true,
            pageSize: 5,
            transport: {
                read: {
                    type: 'post',
                    dataType: 'json',
                    url: '@Url.Action("GridWithGroup")'
                }
            },
            schema: {
                groups: 'Groups',
                aggregates: 'Aggregates',
                data: 'Data',
                total: 'Total',
                model: {
                    id: 'Id',
                    fields: {
                        CompanyName: { type: 'string' },
                        MainCompanyName: { type: 'string' },
                        Number: { type: 'number' },
                        First: { type: 'string' },
                        Last: { type: 'string' },
                        Full: { type: 'string' },
                        Email: { type: 'string' },
                        HireDate: { type: 'date' },
                        IsManager: { type: 'boolean' }
                    }
                }
            },
            /*
            group: [{
                field: "CompanyName",
                aggregates: [
                    {
                        field: "First",
                        aggregate: "count"
                    },
                    {
                        field: "Id",
                        aggregate: "sum"
                    }
                ]
            }]*/
        };
        
        $('#gridWithGroup').kendoGrid({
            dataSource: dataSourceWithGroup,
            height: '228px',
            columns: [
                {
                     field: 'Id', width: '78px', filterable: false, sortable: false, title: ' ',
                     template:
                         '<a href="/Employee/Details/#=Id#"><img class=iconLink src=/Content/Images/view.png></a>' + '&nbsp;' +
                             '<a href="/Employee/Edit/#=Id#"><img class=iconLink src=/Content/Images/edit.png></a>' +
                             '<a href="/Employee/Delete/#=Id#"><img class=iconLink style=padding-right:0px src=/Content/Images/delete.png></a>'
                },
                { field: 'CompanyName', title: 'Company', groupHeaderTemplate: "Company : #= value#" },
                { field: 'MainCompanyName', title: 'Main Company' },
                { field: 'Number', title: 'Employee #' },
                { field: 'First', title: 'First' },
                { field: 'Last', title: 'Last', groupHeaderTemplate: "Last : #= value#" },
                { field: 'Full', title: 'FullName' },
                { field: 'Email' },
                { field: 'HireDate', title: 'Hire Date', format: "{0:MM/dd/yyyy}" },
                { field: 'IsManager', title: 'Manager' }
            ],
            filterable: true,
            sortable: {
                mode: 'multiple'
            },
            pageable: {
                refresh: true,
                pageSizes: true
            },
            groupable: true
        });
        
        var dataSourceManagers = {
            serverPaging: true,
            serverSorting: true,
            serverFiltering: true,
            pageSize: 5,
            transport: {
                read: {
                    type: 'post',
                    dataType: 'json',
                    url: '@Url.Action("GridManagers")'
                }
            },
             schema: {
                 data: 'Data',
                 total: 'Total',
                 model: {
                     id: 'Id',
                     fields: {
                         Number: { type: 'number' },
                         First: { type: 'string' },
                         Last: { type: 'string' },
                         Full: { type: 'string' },
                         Email: { type: 'string' },
                         HireDate: { type: 'date' }
                     }
                 }
             }
         };

        var ViewModel = function () {
            this.managers = {
                data: null,
                dataSource: dataSourceManagers,
                columns: [
                    { field: 'Number', title: 'Employee #' },
                    { field: 'First', title: 'FirstName' },
                    { field: 'Last', title: 'LastName' },
                    { field: 'Full', title: 'FullName' },
                    { field: 'Email' },
                    { field: 'HireDate', title: 'Hire Date', format: "{0:MM/dd/yyyy}" }
                ],
                filterable: true,
                sortable: {
                    mode: 'multiple'
                },
                pageable: false
            };
        };

        ko.applyBindings(new ViewModel());
       
        /*
        $('#gridManagersx').kendoGrid({
            dataSource: dataSourceManagers,
            columns: [
                { field: 'Number', title: 'Employee #' },
                { field: 'First', title: 'FirstName' },
                { field: 'Last', title: 'LastName' },
                { field: 'Full', title: 'FullName' },
                { field: 'Email' },
                { field: 'HireDate', title: 'Hire Date', format: "{0:MM/dd/yyyy}" }
            ],
            filterable: true,
            sortable: {
                mode: 'multiple'
            },
            pageable: true
        });*/
    });
   
</script>